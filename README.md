# CodeLab Core Service

**Personal Multi-Agent AI Platform v1.0**

Полностью децентрализованная персональная мультиагентная AI платформа с изолированными агентами, векторной памятью и real-time взаимодействием.

## 🎯 Описание проекта

CodeLab Core Service — это backend-сервис для создания и управления персональными AI-агентами. Каждый пользователь получает собственную изолированную команду агентов с индивидуальной памятью, оркестратором задач и системой контроля выполнения.

### Ключевые особенности

- **🤖 100% персональные агенты** — каждый пользователь создает и управляет только своими агентами
- **🔒 Полная изоляция** — User123 не имеет доступа к агентам User456
- **⚡ Два режима работы**:
  - Прямой вызов `@agent_name` — быстрый ответ (1-2 сек)
  - Автоматический режим — оркестратор планирует и распределяет задачи
- **🧠 Векторная память** — каждый агент имеет собственный контекст в Qdrant (до 1M+ векторов)
- **📡 Real-time SSE** — мгновенные обновления статуса выполнения задач
- **🛡️ Approval Manager** — контроль выполнения tools и планов задач

## 🏗️ Архитектура

```
┌────────────────────┐    SSE    ┌──────────────────┐
│   User123          │◄───┬───FastAPI Gateway────┤ User123 Space   │
│ ├─Dashboard        │   │    │ User Isolation   │ ├─Orchestrator   │
│ ├─/my/agents/      │   │    │ Middleware       │ ├─Agents[3+]     │
│ └─Direct @coder    │   │    └──────────┬───────┘ ├─Task Bus       │
└────────────────────┘   │               │         ├─Qdrant Context │
                         │               │         └──────┬─────────┘
                         ▼               ▼                │
                    ┌──────────────────────────────┐    │
                    │        INFRASTRUCTURE        │    │
                    │ ├─PostgreSQL (sharded)       │    │
                    │ ├─Redis (queues)             │    │
                    │ ├─Qdrant (vectors/agent)     │◄───┘
                    │ └─LLM Pool                   │
                    └──────────────────────────────┘
```

## 🚀 Основные возможности

### Управление агентами

- Создание, редактирование и удаление персональных агентов
- Настройка system prompt, модели LLM и доступных инструментов
- Мониторинг статуса агентов в реальном времени
- Управление памятью каждого агента (очистка, экспорт, статистика)

### Чат-система

- **Прямой вызов агента**: `@coder "напиши FastAPI роуты"` — обходит оркестратор
- **Автоматический режим**: оркестратор анализирует задачу и создает граф выполнения
- SSE-поток событий для отслеживания прогресса
- История сообщений и контекст сессий

### Персональный оркестратор

- Автоматическое планирование сложных задач
- Построение графа зависимостей между подзадачами
- Параллельное выполнение независимых задач (до 3 одновременно)
- Оценка стоимости и времени выполнения

### Approval Manager

- Подтверждение выполнения критичных инструментов (камера, геолокация)
- Утверждение планов задач перед выполнением
- Отклонение с указанием причины

## 📁 Структура проекта

```
codelab-core-service/
├── doc/                              # Документация
│   ├── techincal-requrements.md      # Техническое задание v1.0
│   ├── rest-api.md                   # Спецификация REST API
│   ├── agent-context.md              # Агентный контекст и память
│   └── samples.md                    # Примеры использования
├── openspec/                         # OpenSpec спецификации
│   ├── config.yaml                   # Конфигурация OpenSpec
│   └── changes/                      # Изменения и задачи
│       └── implement-core-service/   # Текущая реализация
│           ├── proposal.md           # Предложение изменений
│           ├── design.md             # Дизайн решения
│           ├── tasks.md              # Список задач
│           └── specs/                # Детальные спецификации компонентов
├── README.md                         # Этот файл
└── LICENSE                           # MIT License
```

## 🛠️ Технологический стек

| Компонент | Технология |
|-----------|------------|
| Framework | FastAPI 0.115+ |
| ORM | SQLAlchemy 2.0 (asyncpg) |
| Vector DB | Qdrant (изолированные коллекции) |
| Cache | Redis 7+ |
| Database | PostgreSQL 16+ (sharded) |
| SSE | StreamingResponse |
| Deployment | Docker + Kubernetes |

## 📋 REST API

Все эндпоинты доступны через префикс `/my/*` и требуют JWT-аутентификации.

### Основные эндпоинты

```
# Агенты
GET    /my/agents/                          # Список агентов
POST   /my/agents/                          # Создать агента
PUT    /my/agents/{agent_id}/               # Обновить агента
DELETE /my/agents/{agent_id}/               # Удалить агента

# Чат
POST   /my/chat/sessions/                   # Создать сессию
POST   /my/chat/{session_id}/message/       # Отправить сообщение
GET    /my/chat/{session_id}/events/        # SSE поток событий

# Оркестратор
PUT    /my/orchestrators/                   # Настроить оркестратор
POST   /my/orchestrators/test/              # Тестировать планирование

# Approval
POST   /my/tools/{approval_id}/confirm/     # Подтвердить
POST   /my/tools/{approval_id}/reject/      # Отклонить
```

Полная документация API: **Swagger UI на `/my/docs`**

## 🔐 Безопасность

- **User Isolation Middleware** — автоматическая проверка принадлежности ресурсов
- **JWT Authentication** — user_id извлекается из токена
- **Database Filters** — все запросы фильтруются по `user_id`
- **Agent ID Validation** — агенты должны начинаться с `user{user_id}_`
- **Rate Limiting** — 100 запросов/минуту на пользователя

## 📊 Производительность

| Метрика | Требование |
|---------|------------|
| Прямой вызов агента | P95 < 2 сек |
| Планирование оркестратора | P95 < 8 сек |
| Поиск в Qdrant | P95 < 50 мс |
| SSE latency | P99 < 100 мс |
| Uptime | 99.9% |

## 📖 Документация

Подробная документация доступна в папке [`doc/`](doc/):

- [`techincal-requrements.md`](doc/techincal-requrements.md) — полное техническое задание v1.0
- [`rest-api.md`](doc/rest-api.md) — спецификация REST API с примерами
- [`agent-context.md`](doc/agent-context.md) — система векторной памяти агентов
- [`samples.md`](doc/samples.md) — примеры использования API

## 🎯 Статус проекта

**Версия:** 5.1 FINAL  
**Дата утверждения:** 11 февраля 2026  
**Срок сдачи:** 22 марта 2026  
**Длительность:** 41 рабочий день

Текущая реализация находится в активной разработке. Спецификации компонентов доступны в [`openspec/changes/implement-core-service/specs/`](openspec/changes/implement-core-service/specs/).

## 📞 Контакты

**Проект:** OpenIdeaLab  
**Репозиторий:** codelab-core-service

---

**Каждый пользователь = независимая AI команда!** 🎯✨
