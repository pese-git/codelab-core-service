# –ê—É–¥–∏—Ç –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ‚Äî –ü–æ–ª–Ω—ã–π –û—Ç—á–µ—Ç

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞**: 2026-02-21  
**–°—Ç–∞—Ç—É—Å**: –ü—Ä–æ–≤–µ–¥–µ–Ω –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å –≤—ã—è–≤–ª–µ–Ω–∏–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º  
**–£—Ä–æ–≤–µ–Ω—å —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏**: üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô (–Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏)

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-—Ç–µ–∫—É—â–µ–π-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
2. [–ê–Ω–∞–ª–∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ vs –†–µ–∞–ª–∏–∑–∞—Ü–∏—è](#–∞–Ω–∞–ª–∏–∑-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏-vs-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
3. [–í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã](#–≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã)
4. [–î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤](#–¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π-–∞–Ω–∞–ª–∏–∑-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
5. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–ø–æ-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é)
6. [–ü–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è](#–ø–ª–∞–Ω-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è)

---

## –û–±–∑–æ—Ä —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –¢–µ–∫—É—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. Database Model: `UserOrchestrator` ([`app/models/user_orchestrator.py:13-40`](app/models/user_orchestrator.py:13))
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
  - `id`: UUID (PK)
  - `user_id`: UUID (FK ‚Üí User)
  - `project_id`: UUID (FK ‚Üí UserProject)
  - `config`: JSON (—Ö—Ä–∞–Ω–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞)
  - `created_at`: DateTime
  - –ò–Ω–¥–µ–∫—Å –ø–æ `user_id + project_id`

- **–ê–Ω–∞–ª–∏–∑**: –ú–æ–¥–µ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–≤—è–∑—ã–≤–∞–µ—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ –ø—Ä–æ–µ–∫—Ç–æ–º, –Ω–æ ***–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–¥–µ***.

#### 2. Core Method: `orchestrated_execution()` ([`app/core/user_worker_space.py:722-815`](app/core/user_worker_space.py:722))
```python
async def orchestrated_execution(
    self,
    user_message: str,
    session_history: Optional[list[dict[str, str]]] = None,
    task_id: Optional[str] = None,
    metadata: Optional[dict[str, Any]] = None,
) -> dict[str, Any]:
```

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** (—Å—Ç—Ä–æ–∫–∏ 771-791):
```python
# Get Orchestrator or use fallback
selected_agent_id = agents[0]  # ‚ö†Ô∏è –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–≤—ã–π –∞–≥–µ–Ω—Ç!
routing_score = 1.0             # ‚ö†Ô∏è –í—Å–µ–≥–¥–∞ 1.0 –ø—Ä–∏ —É—Å–ø–µ—Ö–µ

try:
    if self.agent_manager:
        # Try to get orchestrator for intelligent routing
        # For now, use first agent as fallback  ‚Üê –ó–ê–ì–õ–£–®–ö–ê!
        logger.info(
            "orchestrated_execution_routing",
            agent_count=len(agents),
            selected_agent_id=str(selected_agent_id),
        )
except Exception as e:
    logger.warning("orchestration_routing_error", error=str(e))
    routing_score = 0.5  # ‚ö†Ô∏è –ü—Ä–∏ –æ—à–∏–±–∫–µ: 0.5
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –≠—Ç–æ –Ω–µ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è! –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ:
1. –ë–µ—Ä–µ—Ç –ø–µ—Ä–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
2. –í—ã—Å—Ç–∞–≤–ª—è–µ—Ç `routing_score = 1.0` –∏–ª–∏ `0.5`
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç —á–µ—Ä–µ–∑ `direct_execution()`
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

#### 3. Unified API: `handle_message()` ([`app/core/user_worker_space.py:817-872`](app/core/user_worker_space.py:817))
```python
async def handle_message(
    self,
    message_content: str,
    target_agent_id: Optional[UUID] = None,
    session_history: Optional[list[dict[str, str]]] = None,
    task_id: Optional[str] = None,
    metadata: Optional[dict[str, Any]] = None,
) -> dict[str, Any]:
```

**–õ–æ–≥–∏–∫–∞**:
- –ï—Å–ª–∏ `target_agent_id` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `direct_execution()`
- –ï—Å–ª–∏ `target_agent_id` is None ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `orchestrated_execution()`

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, –Ω–æ `orchestrated_execution()` —Å–ª–æ–º–∞–Ω–∞

#### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Endpoints

##### 4.1 Chat Endpoint ([`app/routes/project_chat.py:176-275`](app/routes/project_chat.py:176))
```python
@router.post("/{session_id}/message/", response_model=MessageResponse)
async def send_project_message(...):
    # ...
    exec_result = await workspace.handle_message(
        message_content=message_request.content,
        target_agent_id=target_agent_id,  # ‚Üê –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º
        session_history=session_history,
        task_id=str(session_id),
    )
```

**–ü–æ—Ç–æ–∫**:
1. –ï—Å–ª–∏ `message_request.target_agent` –∑–∞–¥–∞–Ω ‚Üí DIRECT —Ä–µ–∂–∏–º
2. –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí ORCHESTRATED —Ä–µ–∂–∏–º (—á–µ—Ä–µ–∑ —Å–ª–æ–º–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ ORCHESTRATED —Ä–µ–∂–∏–º–∞ –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –≤—ã–±—Ä–∞–Ω –ø–µ—Ä–≤—ã–π –∞–≥–µ–Ω—Ç –≤–º–µ—Å—Ç–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏.

##### 4.2 Plan Execution Endpoint ([`app/routes/project_plans.py:550-758`](app/routes/project_plans.py:550))
```python
@router.post("/{plan_id}/execute", response_model=PlanExecutionResponse)
async def execute_plan(...):
    # Find Orchestrator Agent
    orchestrator_id = await find_agent_by_role(db, user_id, project_id, "orchestrator")
    
    # ...
    orchestrator_result = await workspace.direct_execution(
        agent_id=orchestrator_id,
        user_message=orchestrator_prompt,
        task_id=f"plan_execution_{plan_id}",
    )
```

**–ê–Ω–∞–ª–∏–∑**: 
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç Orchestrator Agent –ø–æ —Ä–æ–ª–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `direct_execution()` –¥–ª—è –≤—ã–∑–æ–≤–∞ Orchestrator Agent
- ‚ö†Ô∏è –ù–æ Orchestrator Agent ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –æ–±—ã—á–Ω—ã–π LLM-–∞–≥–µ–Ω—Ç, –∫–æ—Ç–æ—Ä–æ–º—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–º–ø—Ç —Å –∑–∞–¥–∞—á–∞–º–∏
- ‚ö†Ô∏è **–ù–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏**: –ù–µ—Ç –≥—Ä–∞—Ñ–∞ –∑–∞–¥–∞—á, –Ω–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –Ω–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

## –ê–Ω–∞–ª–∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ vs –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: Architect vs Orchestrator

**–í–ê–ñ–ù–û**: –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è Personal Orchestrator –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –¥–≤—É—Ö —Ä–∞–∑–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

#### 1Ô∏è‚É£ Architect Agent (—Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞)
- **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**: –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí —Å–æ–∑–¥–∞–≤–∞—Ç—å –≥—Ä–∞—Ñ –∑–∞–¥–∞—á
- **Scope**: Natural language processing, task dependency analysis, task graph construction
- **–ì–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: LLM-–∞–≥–µ–Ω—Ç —Å —Ä–æ–ª—å—é "architect" –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç plan
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ endpoints (`/my/projects/{project_id}/plans/`)

#### 2Ô∏è‚É£ Orchestrator System (–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ + –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è)
- **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**: 
  - üéØ **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π**: –í—ã–±–∏—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –∑–∞–¥–∞—á–∏
  - üéØ **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞**: –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –∑–∞–¥–∞—á
  - üéØ **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**: –ó–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –∑–∞–¥–∞—á–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
  - üéØ **–û—Ü–µ–Ω–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤**: –û—Ü–µ–Ω–∏–≤–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ / —Å–ª–æ–º–∞–Ω–æ

### –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: Personal Orchestrator ([`openspec/changes/archive/2026-02-21-implement-core-service/specs/personal-orchestrator/spec.md:1-322`](openspec/changes/archive/2026-02-21-implement-core-service/specs/personal-orchestrator/spec.md:1))

**–¢–†–ï–ë–û–í–ê–ù–ò–Ø —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏, –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ –û–†–ö–ï–°–¢–†–ê–¢–û–†–£** (–Ω–µ –∫ Architect):

#### Requirement 1: –†–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏
- **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: "Orchestrator –î–û–õ–ñ–ï–ù —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏ –∏–∑ –ë–î (UserAgent model)"
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢
  - –ù–µ—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î –∑–∞ –∞–≥–µ–Ω—Ç–∞–º–∏
  - –ù–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ capabilities –∞–≥–µ–Ω—Ç–æ–≤
  - –ù–µ—Ç –≤—ã–±–æ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏

#### Requirement 2: ~~–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –∑–∞–¥–∞—á –∏–∑ natural language~~ ‚ûú **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –∑–∞–¥–∞—á**
- **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: 
  - "–í—ã–ø–æ–ª–Ω—è–µ—Ç –≥—Ä–∞—Ñ –∑–∞–¥–∞—á –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ" (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç Architect –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
  - "–¢–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —É–∂–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞"
  - "–ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å A‚ÜíB‚ÜíC –ø–æ—Ä—è–¥–∫–æ–º"
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û / –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
  - –í `execute_plan()`: –±–µ—Ä–µ—Ç Orchestrator Agent –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–º—É —Ç–µ–∫—Å—Ç–æ–≤—ã–π prompt —Å –∑–∞–¥–∞—á–∞–º–∏
  - LLM –º–æ–∂–µ—Ç "–∑–∞–±—ã—Ç—å" –∑–∞–¥–∞—á—É –∏–ª–∏ –Ω–∞—Ä—É—à–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ (–Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–æ)
  - –ù–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–π –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ

#### Requirement 3: –¢–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ **—É–∂–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞** –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**:
  - "–ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á–∏ –ø–æ —É—Ä–æ–≤–Ω—è–º (–∏–∑ —É–∂–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞)"
  - "–ó–∞–ø—É—Å–∫–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –∑–∞–¥–∞—á–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (max 3 –∞–≥–µ–Ω—Ç–∞)"
  - "–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢
  - –ù–µ—Ç —Ç–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
  - –ù–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (LLM –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ)
  - –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π –ø–æ—Ä—è–¥–∫–∞

#### Requirement 4: –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏ **–ø–ª–∞–Ω–∞**
- **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**:
  - "–û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ –≤ $"
  - "–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω (min-max) –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ø–ª–∞–Ω–∞"
  - "–ü–æ–º–µ—á–∞–µ—Ç –ø–ª–∞–Ω –∫–∞–∫ high_cost –µ—Å–ª–∏ > $1.00"
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢
  - –ù–µ—Ç –∫–∞–ª—å–∫—É–ª—è—Ü–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
  - –ù–µ—Ç –æ—Ü–µ–Ω–∫–∏ –≤—Ä–µ–º–µ–Ω–∏

#### Requirement 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ApprovalManager –¥–ª—è **–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–ª–∞–Ω–∞**
- **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**:
  - "–î–û–õ–ñ–ï–ù —Ç—Ä–µ–±–æ–≤–∞—Ç—å –æ–¥–æ–±—Ä–µ–Ω–∏–µ –¥–ª—è –ø–ª–∞–Ω–æ–≤ —Å 3+ –∑–∞–¥–∞—á–∞–º–∏ –∏–ª–∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é > $0.10"
  - "–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–ª–∞–Ω –≤ ApprovalManager —Å –¥–µ—Ç–∞–ª—è–º–∏"
  - "–ñ–¥–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º"
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û
  - ApprovalManager –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `execute_plan()` –Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞–Ω.requires_approval
  - –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ –æ–¥–æ–±—Ä–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ complexity/cost
  - –ù–µ—Ç —Ä–∞—Å—á–µ—Ç–∞ —ç—Ç–∏—Ö –º–µ—Ç—Ä–∏–∫

#### Requirement 6: –í—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–æ–≤ **–¥–ª—è –∑–∞–¥–∞—á –≤ –ø–ª–∞–Ω–µ** –Ω–∞ –æ—Å–Ω–æ–≤–µ capabilities
- **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**:
  - "–í—ã–±–∏—Ä–∞–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ –ø–ª–∞–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö capabilities"
  - "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç `user_agents.config['metadata']['capabilities']`"
  - "–ò—Å–∫–ª—é—á–∞–µ—Ç –∞–≥–µ–Ω—Ç–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'error' –∏–ª–∏ 'busy'"
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢
  - –ù–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ capabilities
  - –ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–µ—Å—å –ø–ª–∞–Ω LLM'—É

#### Requirement 7: –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–æ–≤—ã–π)
- **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: "–î–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –±–µ–∑ –ø–ª–∞–Ω–∞: –≤—ã–±–∏—Ä–∞—Ç—å –ª—É—á—à–µ–≥–æ –∞–≥–µ–Ω—Ç–∞"
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢
  - `orchestrated_execution()` –ø—Ä–æ—Å—Ç–æ –±–µ—Ä–µ—Ç –ø–µ—Ä–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞

### –¢–∞–±–ª–∏—Ü–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è (–¢–û–õ–¨–ö–û —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è Orchestrator)

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|-----------|-----------|--------------|-----------|--------|
| –†–∞–±–æ—Ç–∞ —Å UserAgent –∏–∑ –ë–î | Orchestrator | ‚úÖ –û–ø–∏—Å–∞–Ω–æ | ‚ùå –ù–µ—Ç –∫–æ–¥–∞ | üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï |
| –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π | Orchestrator | ‚úÖ –û–ø–∏—Å–∞–Ω–æ | ‚ùå –ù–µ—Ç –∫–æ–¥–∞ | üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï |
| –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ (–ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ) | Orchestrator | ‚úÖ –û–ø–∏—Å–∞–Ω–æ | ‚ö†Ô∏è LLM –≤–º–µ—Å—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º—ã | üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï |
| –¢–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ | Orchestrator | ‚úÖ –û–ø–∏—Å–∞–Ω–æ | ‚ùå –ù–µ—Ç –∫–æ–¥–∞ | üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï |
| –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ | Orchestrator | ‚úÖ –û–ø–∏—Å–∞–Ω–æ | ‚ùå –ù–µ—Ç –∫–æ–¥–∞ | üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï |
| –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–ª–∞–Ω–∞ | Orchestrator | ‚úÖ –û–ø–∏—Å–∞–Ω–æ | ‚ùå –ù–µ—Ç –∫–æ–¥–∞ | üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï |
| –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø–ª–∞–Ω–∞ | Orchestrator | ‚úÖ –û–ø–∏—Å–∞–Ω–æ | ‚ùå –ù–µ—Ç –∫–æ–¥–∞ | üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï |
| ApprovalManager –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | Orchestrator | ‚úÖ –û–ø–∏—Å–∞–Ω–æ | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | üü† HIGH |
| –í—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–æ–≤ –ø–æ capabilities | Orchestrator | ‚úÖ –û–ø–∏—Å–∞–Ω–æ | ‚ùå –ù–µ—Ç –∫–æ–¥–∞ | üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï |
| –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –∑–∞–¥–∞—á | **Architect** | ‚úÖ –û–ø–∏—Å–∞–Ω–æ | ‚úÖ LLM Agent | ‚úÖ OK |

**–í—ã–≤–æ–¥**: ~20% —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ. üìä –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï.

---

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 1: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ [CRITICAL]

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ú–µ—Ç–æ–¥ `orchestrated_execution()` –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∏–∫–∞–∫–æ–π –ª–æ–≥–∏–∫–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏.

**–¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**:
```python
# –°—Ç—Ä–æ–∫–∞ 773: –ü—Ä–æ—Å—Ç–æ –±–µ—Ä–µ—Ç –ø–µ—Ä–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
selected_agent_id = agents[0]
routing_score = 1.0

# –°—Ç—Ä–æ–∫–∞ 776-784: –ü—ã—Ç–∞–µ—Ç—Å—è —á—Ç–æ-—Ç–æ —Å–¥–µ–ª–∞—Ç—å, –Ω–æ –Ω–µ –¥–µ–ª–∞–µ—Ç –Ω–∏—á–µ–≥–æ
try:
    if self.agent_manager:
        # Try to get orchestrator for intelligent routing
        # For now, use first agent as fallback  ‚Üê –ó–ê–ì–õ–£–®–ö–ê!
        logger.info(...)
except Exception as e:
    logger.warning(...)
    routing_score = 0.5
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –ü–æ—Ä—è–¥–æ–∫ –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Å–ø–∏—Å–∫–µ —Å–ª—É—á–∞–π–Ω—ã–π ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Orchestrator Agent –∏–∑ –ë–î
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è capabilities –∞–≥–µ–Ω—Ç–æ–≤
- –ë–µ–∑ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

**–†–∏—Å–∫**: üî¥ –í—ã—Å–æ–∫–∏–π ‚Äî —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–æ–±—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 2: UserOrchestrator –º–æ–¥–µ–ª—å –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–º–µ—Ä—Ç–≤—ã–π –∫–æ–¥) [CRITICAL]

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ú–æ–¥–µ–ª—å `UserOrchestrator` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ –ë–î, –Ω–æ –≤ –∫–æ–¥–µ –æ–Ω–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
- –¢–∞–±–ª–∏—Ü–∞ `user_orchestrators` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î ‚úÖ
- –ú–æ–¥–µ–ª—å [`UserOrchestrator`](app/models/user_orchestrator.py:13) –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ ‚úÖ
- –û—Ç–Ω–æ—à–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (`User.orchestrators`, `UserProject.orchestrators`) ‚úÖ
- **–ù–∏–∫–∞–∫–æ–π –∫–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç**: `db.query(UserOrchestrator).filter(...)` ‚ùå

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–¥–µ**:
```bash
grep -r "UserOrchestrator" app/ --include="*.py"
# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# - app/models/__init__.py (–∏–º–ø–æ—Ä—Ç)
# - app/models/user.py (–æ—Ç–Ω–æ—à–µ–Ω–∏–µ)
# - app/models/user_project.py (–æ—Ç–Ω–æ—à–µ–Ω–∏–µ)
# - app/models/user_orchestrator.py (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
# ‚ùå –ù–ò –û–î–ù–û–ì–û —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ!
```

**–ö–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç Orchestrator**:

–í–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `UserOrchestrator`, Orchestrator Agent —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω—ã–π `UserAgent` —á–µ—Ä–µ–∑ DEFAULT_AGENTS_CONFIG ([`app/core/starter_pack.py:69-121`](app/core/starter_pack.py:69)):

```python
{
    "name": "Orchestrator",
    "config": {
        "model": "openrouter/openai/gpt-4.1",
        "metadata": {
            "role": "orchestrator",
            "capabilities": ["workflow_management", "task_routing", ...],
            ...
        },
    },
}
```

–ò –ø–æ–∏—Å–∫ Orchestrator Agent –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `find_agent_by_role()`:
```python
orchestrator_id = await find_agent_by_role(db, user_id, project_id, "orchestrator")
```

**–ê–Ω–∞–ª–∏–∑**: Orchestrator ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ `UserAgent` —Å–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —Ä–æ–ª—å—é `"orchestrator"`. –û—Ç–¥–µ–ª—å–Ω–∞—è `UserOrchestrator` —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω—É–∂–Ω–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: 
–£–¥–∞–ª–∏—Ç—å `UserOrchestrator` –º–æ–¥–µ–ª—å –∏ —Ç–∞–±–ª–∏—Ü—É ‚Äî —ç—Ç–æ –¥–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∞—è –æ—à–∏–±–∫–∞. –í—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–∂–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `UserAgent.config` (JSON).

**–†–∏—Å–∫**: üî¥ –í—ã—Å–æ–∫–∏–π ‚Äî –º–µ—Ä—Ç–≤—ã–π –∫–æ–¥, –ø—É—Ç–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, –∑–∞–Ω–∏–º–∞–µ—Ç –º–µ—Å—Ç–æ –≤ –ë–î

---

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ [CRITICAL]

**–û–ø–∏—Å–∞–Ω–∏–µ**: –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ capabilities –∞–≥–µ–Ω—Ç–æ–≤, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–æ –±–µ—Ä–µ—Ç –ø–µ—Ä–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞.

**–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç** (–¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π, –Ω–µ –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è):
- "–í—ã–±–∏—Ä–∞–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö capabilities"
- "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç `user_agents.config['metadata']['capabilities']`"
- "–ò—Å–∫–ª—é—á–∞–µ—Ç –∞–≥–µ–Ω—Ç–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'error' –∏–ª–∏ 'busy'"
- –í—ã—Å–æ–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –≤—ã–±–æ—Ä–µ (routing_score –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** –≤ `orchestrated_execution()`:
```python
selected_agent_id = agents[0]  # ‚Üê –ü—Ä–æ—Å—Ç–æ –±–µ—Ä–µ—Ç –ø–µ—Ä–≤–æ–≥–æ!
routing_score = 1.0             # ‚Üê –í—Å–µ–≥–¥–∞ 1.0 –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
```

**–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–±–ª–µ–º**:
```
–°—Ü–µ–Ω–∞—Ä–∏–π 1:
User: "–ù–∞–π–¥–∏ –±–∞–≥ –≤ code.py"
Expected: Select Code Agent (capabilities: "debug", "fix_bug") ‚Üí routing_score: 0.95
Actual:   Select first agent in list (maybe Ask Agent) ‚Üí routing_score: 1.0

–°—Ü–µ–Ω–∞—Ä–∏–π 2:
User: "–ö–∞–∫–æ–π –ø–∞—Ç—Ç–µ—Ä–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∫—ç—à–∞?"
Expected: Select Ask Agent (capabilities: "explain_concept") ‚Üí routing_score: 0.9
Actual:   Select first agent (maybe Code Agent) ‚Üí routing_score: 1.0
```

**–í—ã–≤–æ–¥**: –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–∞ –∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏.

---

### üü† –ü—Ä–æ–±–ª–µ–º–∞ 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ endpoints –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—é—â—É—é –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é [HIGH]

#### Chat API ([`app/routes/project_chat.py:267-272`](app/routes/project_chat.py:267))
```python
exec_result = await workspace.handle_message(
    message_content=message_request.content,
    target_agent_id=target_agent_id,  # –ï—Å–ª–∏ None ‚Üí ORCHESTRATED
    session_history=session_history,
)
```

**–°—Ü–µ–Ω–∞—Ä–∏–π**: 
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ë–ï–ó `target_agent_id`
2. –ö–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç `orchestrated_execution()`
3. –û–∂–∏–¥–∞–µ–º–æ: –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–µ–≥–æ –∞–≥–µ–Ω—Ç–∞
4. –†–µ–∞–ª—å–Ω–æ—Å—Ç—å: –ü—Ä–æ—Å—Ç–æ –±–µ—Ä–µ—Ç –ø–µ—Ä–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞

**–ü—Ä–∏–º–µ—Ä**:
```
User: "–ù–∞–π–¥–∏ –±–∞–≥ –≤ auth.py –∏ –Ω–∞–ø–∏—à–∏ —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏"
Expected: 
  - Task 1: –ù–∞–π—Ç–∏ –±–∞–≥ ‚Üí Code Agent (has capability: "investigate_error")
  - Task 2: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç ‚Üí Code Agent (has capability: "implement_feature")
Actual:
  - –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–≤—ã–π –∞–≥–µ–Ω—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å Ask Agent –∏–ª–∏ Architect)
```

**–†–∏—Å–∫**: üü† –°—Ä–µ–¥–Ω–∏–π ‚Äî —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–±–∏—Ä–∞–µ—Ç –∞–≥–µ–Ω—Ç–æ–≤

---

### üü† –ü—Ä–æ–±–ª–µ–º–∞ 5: Plan Execution –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Orchestrator –∫–∞–∫ –æ–±—ã—á–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ [HIGH]

([`app/routes/project_plans.py:698-721`](app/routes/project_plans.py:698))

```python
# –ù–∞—Ö–æ–¥–∏—Ç Orchestrator Agent
orchestrator_id = await find_agent_by_role(db, user_id, project_id, "orchestrator")

# –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–º—É –∑–∞–¥–∞—á–∏ –∫–∞–∫ —Ç–µ–∫—Å—Ç
orchestrator_prompt = f"""Execute this task plan. For each task, call appropriate agents.

Tasks to execute:
{json.dumps(tasks_for_orchestrator, indent=2)}
"""

# –í—ã–∑—ã–≤–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω—ã–π LLM-–∞–≥–µ–Ω—Ç
orchestrator_result = await workspace.direct_execution(
    agent_id=orchestrator_id,
    user_message=orchestrator_prompt,
)
```

**–ü—Ä–æ–±–ª–µ–º—ã**:
1. Orchestrator ‚Äî —ç—Ç–æ LLM-–∞–≥–µ–Ω—Ç, –Ω–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏
2. –û–Ω –º–æ–∂–µ—Ç "–∑–∞–±—ã—Ç—å" –∫–∞–∫–∏–µ-—Ç–æ –∑–∞–¥–∞—á–∏ –∏–ª–∏ –Ω–∞—Ä—É—à–∏—Ç—å –∏—Ö –ø–æ—Ä—è–¥–æ–∫
3. –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
4. –ù–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è –∑–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
5. –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ –≥—Ä–∞—Ñ–∞ –∑–∞–¥–∞—á

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã**:
```
Plan:
  Task 1: Write code (depends on nothing)
  Task 2: Review code (depends on Task 1)
  Task 3: Merge code (depends on Task 2)

LLM Orchestrator –º–æ–∂–µ—Ç:
  ‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
  ‚ùå –ó–∞–±—ã—Ç—å Task 2
  ‚ùå –í—ã–ø–æ–ª–Ω–∏—Ç—å Task 3 –ø–µ—Ä–µ–¥ Task 1
  ‚ùå "–ì–∞–ª–ª—é—Ü–∏–Ω–∏—Ä–æ–≤–∞—Ç—å" –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
```

**–†–∏—Å–∫**: üü† –°—Ä–µ–¥–Ω–∏–π-–í—ã—Å–æ–∫–∏–π ‚Äî –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

---

### üü° –ü—Ä–æ–±–ª–µ–º–∞ 6: routing_score ‚Äî –º–µ—Ç—Ä–∏–∫–∞ –±–µ–∑ —Å–º—ã—Å–ª–∞ [MEDIUM]

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** ([`app/core/user_worker_space.py:751`](app/core/user_worker_space.py:751)):
```python
"routing_score": float,  # Confidence score (0-1)
```

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞**:
- `routing_score = 1.0` ‚Üí "–ø–µ—Ä–≤—ã–π –∞–≥–µ–Ω—Ç –≤—ã–±—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ"
- `routing_score = 0.5` ‚Üí "–ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤–æ–≥–æ –∫–∞–∫ fallback"

**–ü—Ä–æ–±–ª–µ–º—ã**:
1. –≠—Ç–æ –Ω–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ (–Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è)
2. –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å—Ç–∞—Ç—É—Å-–∫–æ–¥: "—É–¥–∞–ª–æ—Å—å –ª–∏ –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞"
3. –ö–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç score –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π
4. –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–∂–∏–¥–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ confidence –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ capabilities

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å**:
```python
{
  "success": true,
  "response": "...",
  "selected_agent_id": "code-agent-uuid",
  "selected_agent_name": "CodeAssistant",
  "routing_score": 0.95,  # "–ó–∞–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç Code abilities (debug, fix_bug)"
                           # "CodeAssistant –∏–º–µ–µ—Ç —ç—Ç–∏ abilities"
                           # "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 95%"
}
```

**–†–∏—Å–∫**: üü° –°—Ä–µ–¥–Ω–∏–π ‚Äî –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç –æ—Ç–ª–∞–¥–∫—É

---

### üü° –ü—Ä–æ–±–ª–µ–º–∞ 7: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å ApprovalManager [MEDIUM]

**–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç** ([`openspec/changes/archive/2026-02-21-implement-core-service/specs/personal-orchestrator/spec.md:157-191`](openspec/changes/archive/2026-02-21-implement-core-service/specs/personal-orchestrator/spec.md:157)):
```
"–í—Å–µ –ø–ª–∞–Ω—ã —Å 3+ –∑–∞–¥–∞—á–∞–º–∏ –∏–ª–∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é > $0.10 –î–û–õ–ñ–ù–´ –±—ã—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º"
```

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- ‚úÖ ApprovalManager —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ `execute_plan()`
- ‚ö†Ô∏è –ù–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏/—Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–ª–∞–Ω–∞ **–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω**

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–µ–π—á–∞—Å** ([`app/routes/project_plans.py:614-649`](app/routes/project_plans.py:614)):
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ —è–≤–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ–ª–∞–≥ –≤ –ø–ª–∞–Ω–µ
if plan.requires_approval and plan.status == "created":
    approval_manager = ApprovalManager(...)
    approval_req = await approval_manager.request_plan_approval(plan=plan)
```

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å**:
1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞–Ω–∞: Architect –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏ —Å–æ–∑–¥–∞–µ—Ç –ø–ª–∞–Ω
2. –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–∑–∞–¥–∞—á >= 3 –∏–ª–∏ estimated_cost > $0.10
3. –ï—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–ª–∞–Ω –Ω–∞ –æ–¥–æ–±—Ä–µ–Ω–∏–µ
4. –ù–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–ª–∞–Ω –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–¥–æ–±—Ä–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Å–ª–æ–∂–Ω—ã–π –ø–ª–∞–Ω (10+ –∑–∞–¥–∞—á, $5 —Å—Ç–æ–∏–º–æ—Å—Ç—å) –∏ –æ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ë–ï–ó –æ–¥–æ–±—Ä–µ–Ω–∏—è, –µ—Å–ª–∏ Architect –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª `requires_approval=true`

**–†–∏—Å–∫**: üü° –°—Ä–µ–¥–Ω–∏–π ‚Äî –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–µ/–¥–æ—Ä–æ–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –±–µ–∑ –æ–¥–æ–±—Ä–µ–Ω–∏—è

---

## –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç 1: `UserOrchestrator` Model

**–°—Ç–∞—Ç—É—Å**: üü° –û–ø—Ä–µ–¥–µ–ª–µ–Ω, –Ω–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
```python
class UserOrchestrator(Base):
    """User orchestrator model."""
    id: Mapped[UUID]
    user_id: Mapped[UUID]  # ‚úÖ Per-user isolation
    project_id: Mapped[UUID]  # ‚úÖ Per-project isolation
    config: Mapped[dict]  # ‚úÖ –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

**–ß—Ç–æ –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å** (–ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏):
```python
config = {
    "routing_strategy": "capability_matching",  # –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
    "max_parallel_agents": 3,  # –ú–∞–∫—Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    "approval_threshold_cost": 0.10,  # –ö–æ–≥–¥–∞ —Ç—Ä–µ–±–æ–≤–∞—Ç—å –æ–¥–æ–±—Ä–µ–Ω–∏–µ
    "approval_threshold_tasks": 3,  # –ö–æ–≥–¥–∞ —Ç—Ä–µ–±–æ–≤–∞—Ç—å –æ–¥–æ–±—Ä–µ–Ω–∏–µ
    "timeout_seconds": 300,  # Timeout –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    "fallback_behavior": "first_agent",  # –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
}
```

**–ß—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**: ‚ùå –ù–∏–∫–∞–∫–∏–µ –ø–æ–ª—è –∫–æ–Ω—Ñ–∏–≥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: 
- –õ–∏–±–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ñ–∏–≥–æ–º
- –õ–∏–±–æ —É–¥–∞–ª–∏—Ç—å –º–æ–¥–µ–ª—å –∫–∞–∫ –º–µ—Ä—Ç–≤—ã–π –∫–æ–¥

---

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç 2: `orchestrated_execution()` Method

**–°—Ç–∞—Ç—É—Å**: üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ —Å–ª–æ–º–∞–Ω

**–ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: 
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç—Ä–µ–±—É–µ–º—ã–µ –∑–∞–¥–∞—á–∏
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç capabilities –∞–≥–µ–Ω—Ç–æ–≤
- –í—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–µ–≥–æ –∞–≥–µ–Ω—Ç–∞ (–∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –≥—Ä–∞—Ñ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –≤—ã—Å–æ–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–¥** (57 —Å—Ç—Ä–æ–∫):
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é workspace
2. –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–≥–µ–Ω—Ç–æ–≤
3. **–ë–µ—Ä–µ—Ç –ø–µ—Ä–≤–æ–≥–æ –∏–∑ —Å–ø–∏—Å–∫–∞** (–ª–∏–Ω–∏—è 773)
4. –í—ã—Å—Ç–∞–≤–ª—è–µ—Ç routing_score = 1.0 (–ª–∏–Ω–∏—è 774)
5. –ü—ã—Ç–∞–µ—Ç—Å—è —á—Ç–æ-—Ç–æ —Å–¥–µ–ª–∞—Ç—å –≤ try/except, –Ω–æ –Ω–µ –¥–µ–ª–∞–µ—Ç –Ω–∏—á–µ–≥–æ (775-784)
6. –í—ã–∑—ã–≤–∞–µ—Ç `direct_execution()` —Å –ø–µ—Ä–≤—ã–º –∞–≥–µ–Ω—Ç–æ–º
7. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–í—ã–≤–æ–¥**: –≠—Ç–æ –∑–∞–≥–ª—É—à–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –∏–º–∏—Ç–∏—Ä—É–µ—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é.

---

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç 3: `handle_message()` Unified API

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏

**–õ–æ–≥–∏–∫–∞**:
```python
if target_agent_id:
    return await self.direct_execution(...)  # ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
else:
    return await self.orchestrated_execution(...)  # ‚ùå –°–ª–æ–º–∞–Ω–∞
```

**–ê–Ω–∞–ª–∏–∑**:
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π API
- ‚ùå –û–¥–Ω–∞ –∏–∑ –≤–µ—Ç–æ–∫ —Å–ª–æ–º–∞–Ω–∞

---

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç 4: Integration in Chat Endpoint

**–°—Ç–∞—Ç—É—Å**: üü° –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –ª–æ–≥–∏–∫–∞ —Å–ª–æ–º–∞–Ω–∞

**–ü–æ—Ç–æ–∫**:
```
User ‚Üí send_project_message() ‚Üí handle_message() ‚Üí 
  [if target_agent] direct_execution() 
  [if not target_agent] orchestrated_execution() ‚ùå BROKEN
```

**–ê–Ω–∞–ª–∏–∑**:
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ unified API
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ session history
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚ùå –†–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏–∑-–∑–∞ —Å–ª–æ–º–∞–Ω–Ω–æ–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏

---

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç 5: Integration in Plan Execution Endpoint

**–°—Ç–∞—Ç—É—Å**: üü° –†–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ü–æ—Ç–æ–∫**:
```
execute_plan() ‚Üí 
  find_agent_by_role("orchestrator") ‚Üí 
  direct_execution(orchestrator_agent, tasks_prompt) ‚Üí 
  [LLM –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á–∏ –∫–∞–∫ —Ç–µ–∫—Å—Ç] ‚ùå –ù–ï–î–ï–¢–ï–†–ú–ò–ù–ò–†–û–í–ê–ù–û
```

**–ê–Ω–∞–ª–∏–∑**:
- ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–º—É –∑–∞–¥–∞—á–∏
- ‚ùå LLM –º–æ–∂–µ—Ç "–∑–∞–±—ã—Ç—å" –∑–∞–¥–∞—á–∏ –∏–ª–∏ –Ω–∞—Ä—É—à–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫
- ‚ùå –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚ùå –ù–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ [3-4 –¥–Ω—è]
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é:
- –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å capabilities –∞–≥–µ–Ω—Ç–æ–≤
- –í—ã–±–∏—Ä–∞—Ç—å –∞–≥–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–¥–∞—á–∏
- –í–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π confidence score

**–ú–∏–Ω—É—Å—ã**: –ù–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≥—Ä–∞—Ñ–∞ –∑–∞–¥–∞—á

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è [2-3 –Ω–µ–¥–µ–ª–∏] 
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω—É—é —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é:
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –∑–∞–¥–∞—á
- –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –¢–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ApprovalManager

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**: –ë–æ–ª—å—à–µ —Ä–∞–±–æ—Ç—ã –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### –í–∞—Ä–∏–∞–Ω—Ç 3: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ [1 –Ω–µ–¥–µ–ª—è]
1. –ë—ã—Å—Ç—Ä–æ: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é (–í–∞—Ä–∏–∞–Ω—Ç 1)
2. –ü–æ–∑–∂–µ: –î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∞ (–í–∞—Ä–∏–∞–Ω—Ç 2)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: üéØ **–í–∞—Ä–∏–∞–Ω—Ç 3** ‚Äî –±—ã—Å—Ç—Ä–æ —Ä–µ—à–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–±–ª–µ–º—É, –æ—Å—Ç–∞–≤–ª—è—è –¥–≤–µ—Ä—å –æ—Ç–∫—Ä—ã—Ç–æ–π –¥–ª—è –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–∑–∂–µ.

---

### üìã –ü–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

#### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ [2-3 –¥–Ω—è]

**1.1 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ capabilities**

–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –≤ `UserWorkerSpace`:
```python
async def select_best_agent_for_task(
    self,
    user_message: str,
    available_agents: list[UUID],
) -> tuple[UUID, float]:
    """Select best agent based on task analysis and agent capabilities.
    
    Returns:
        (agent_id, confidence_score)
    """
```

**–õ–æ–≥–∏–∫–∞**:
1. –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å `user_message` (–ø—Ä–æ—Å—Ç–æ–π NLP: –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞)
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–≥–µ–Ω—Ç–∞:
   - –ü–æ–ª—É—á–∏—Ç—å capabilities –∏–∑ config
   - –í—ã—á–∏—Å–ª–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å —Ç—Ä–µ–±—É–µ–º—ã–º–∏ abilities
3. –í—ã–±—Ä–∞—Ç—å –∞–≥–µ–Ω—Ç–∞ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ–º
4. –í–µ—Ä–Ω—É—Ç—å (agent_id, confidence_score)

**–ü—Ä–∏–º–µ—Ä**:
```python
# Message: "–ù–∞–π–¥–∏ –±–∞–≥ –≤ auth.py"
# –¢—Ä–µ–±—É–µ–º—ã–µ abilities: ["debug", "code_analysis"]

# Agents:
# - Ask Agent: capabilities = ["answer_question"]  ‚Üí score = 0.0
# - Code Agent: capabilities = ["debug", "fix_bug"] ‚Üí score = 0.8 ‚úÖ SELECT
# - Architect: capabilities = ["design"]           ‚Üí score = 0.1
```

**1.2 –û–±–Ω–æ–≤–∏—Ç—å `orchestrated_execution()`**

```python
async def orchestrated_execution(...):
    agents = await self.list_agents_for_project()
    
    # ‚úÖ –ù–û–í–û–ï: –í—ã–±—Ä–∞—Ç—å –ª—É—á—à–µ–≥–æ –∞–≥–µ–Ω—Ç–∞
    selected_agent_id, routing_score = await self.select_best_agent_for_task(
        user_message=user_message,
        available_agents=agents,
    )
    
    # –í—ã–ø–æ–ª–Ω–∏—Ç—å
    result = await self.direct_execution(
        agent_id=selected_agent_id,
        user_message=user_message,
        session_history=session_history,
        task_id=task_id,
        metadata=metadata,
    )
    
    return {
        **result,
        "selected_agent_id": str(selected_agent_id),
        "routing_score": routing_score,  # ‚úÖ –†–ï–ê–õ–¨–ù–ê–Ø –æ—Ü–µ–Ω–∫–∞
    }
```

**1.3 –î–æ–±–∞–≤–∏—Ç—å unit tests**

```python
async def test_orchestrated_execution_selects_best_agent():
    # –°–æ–∑–¥–∞—Ç—å workspace —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏
    # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å, —Ç—Ä–µ–±—É—é—â–∏–π Code Agent
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω Code Agent, –∞ –Ω–µ –ø–µ—Ä–≤—ã–π
    pass

async def test_routing_score_reflects_confidence():
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ routing_score –≤—ã—Å–æ–∫–∏–π –¥–ª—è –ø–æ–¥—Ö–æ–¥—è—â–µ–π –∑–∞–¥–∞—á–∏
    # –ò –Ω–∏–∑–∫–∏–π –¥–ª—è –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–µ–π –∑–∞–¥–∞—á–∏
    pass
```

**–≠—Å—Ç–∏–º–∞—Ç–æ—Ä**: 2-3 –¥–Ω—è (–≤–∫–ª—é—á–∞—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ `select_best_agent_for_task()` –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
- ‚úÖ `routing_score` –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
- ‚úÖ Unit tests –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ Integration tests —Å endpoints –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (–µ—Å–ª–∏ –±—ã–ª–∞ –∑–∞–≥–ª—É—à–∫–∞)

---

#### –§–∞–∑–∞ 2: –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ [1 –¥–µ–Ω—å]

**2.1 –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**

–°–æ–∑–¥–∞—Ç—å `doc/ORCHESTRATOR_IMPLEMENTATION_STATUS.md`:
- –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–±–∞–∑–æ–≤–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è)
- –ß—Ç–æ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–≥—Ä–∞—Ñ –∑–∞–¥–∞—á, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
- –ü–ª–∞–Ω –Ω–∞ –±—É–¥—É—â–µ–µ

**2.2 –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é**

–ï—Å–ª–∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –≥–æ–≤–æ—Ä–∏—Ç –æ –ø–æ–ª–Ω–æ–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏, –Ω–æ –º—ã –¥–µ–ª–∞–µ–º —Ç–æ–ª—å–∫–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é:
- –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π spec –¥–ª—è "Intelligent Agent Routing"
- –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ PHASE 1
- –û–±–Ω–æ–≤–∏—Ç—å Personal Orchestrator spec –∫–∞–∫ PHASE 2

**2.3 Code review**

- –ü—Ä–æ–≤–µ—Å—Ç–∏ review –Ω–æ–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å backward compatibility
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ existing endpoints —Ä–∞–±–æ—Ç–∞—é—Ç

**–≠—Å—Ç–∏–º–∞—Ç–æ—Ä**: 1 –¥–µ–Ω—å

---

#### –§–∞–∑–∞ 3: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è [2-3 –Ω–µ–¥–µ–ª–∏, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ]

**3.1 –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –∑–∞–¥–∞—á** [1 –Ω–µ–¥–µ–ª—è]
- –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å ‚Üí –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ç—Ä–µ–±—É–µ–º—ã–µ –∑–∞–¥–∞—á–∏
- –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏
- –°—Ç—Ä–æ–∏—Ç—å DAG (directed acyclic graph)

**3.2 –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** [3-5 –¥–Ω–µ–π]
- –¢–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ —É—Ä–æ–≤–Ω—è–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**3.3 –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏** [3-5 –¥–Ω–µ–π]
- –û—Ü–µ–Ω–∫–∞ LLM calls
- –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ embeddings
- –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**3.4 ApprovalManager –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** [2-3 –¥–Ω—è]
- –ü—Ä–æ–≤–µ—Ä–∫–∞ threshold (3+ –∑–∞–¥–∞—á–∏ –∏–ª–∏ > $0.10)
- –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –æ–¥–æ–±—Ä–µ–Ω–∏–µ
- –û–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

---

## –ü–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### üöÄ –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–î–Ω—è 1-2)

1. **–°–æ–∑–¥–∞—Ç—å OpenSpec change** –¥–ª—è "Intelligent Agent Routing"
   - Proposal: –ò—Å–ø—Ä–∞–≤–∏—Ç—å `orchestrated_execution()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è capabilities
   - Design: –û–ø–∏—Å–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ –∞–≥–µ–Ω—Ç–∞
   - Specs: –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - Tasks: –°–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç

2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `select_best_agent_for_task()`**
   - –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ ‚Üí –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å capabilities –∞–≥–µ–Ω—Ç–æ–≤
   - –í—ã—á–∏—Å–ª–µ–Ω–∏–µ confidence score

3. **–û–±–Ω–æ–≤–∏—Ç—å `orchestrated_execution()`**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥
   - –í–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π routing_score

4. **–î–æ–±–∞–≤–∏—Ç—å tests**
   - Unit tests –¥–ª—è `select_best_agent_for_task()`
   - Integration tests —Å endpoints

### üìã –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–î–µ–Ω—å 3-7)

1. **Code review –∏ fixes**
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   - Performance checks
   - Edge cases

2. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - Update REST API docs
   - Update developer guide
   - Create migration guide (–µ—Å–ª–∏ –µ—Å—Ç—å breaking changes)

3. **–ó–∞–ø—É—Å–∫ –≤ Production**
   - Deploy –Ω–∞ staging
   - Smoke tests
   - Deploy –Ω–∞ production

### üéØ –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (2-3 –Ω–µ–¥–µ–ª–∏)

1. **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –∑–∞–¥–∞—á**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å task graph creation
   - Dependency analysis
   - Topological sorting

2. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**
   - Implement concurrent execution
   - Task level error handling
   - Progress tracking

3. **Approval system**
   - Integrate with ApprovalManager
   - Cost/time estimation
   - Approval UI

---

## –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ üî¥

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç** ‚úÖ:
- Architect Agent —Å–æ–∑–¥–∞–µ—Ç –ø–ª–∞–Ω—ã —á–µ—Ä–µ–∑ LLM
- Plan Execution endpoint –∑–∞–ø—É—Å–∫–∞–µ—Ç Orchestrator Agent
- Chat endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é (direct vs orchestrated)
- User Agent —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ß—Ç–æ —Å–ª–æ–º–∞–Ω–æ** ‚ùå:
1. `orchestrated_execution()` –Ω–µ –≤—ã–±–∏—Ä–∞–µ—Ç –∞–≥–µ–Ω—Ç–∞ –ø–æ capabilities ‚Äî –ø—Ä–æ—Å—Ç–æ –±–µ—Ä–µ—Ç –ø–µ—Ä–≤–æ–≥–æ
2. `UserOrchestrator` –º–æ–¥–µ–ª—å –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ‚Äî –º–µ—Ä—Ç–≤—ã–π –∫–æ–¥ –≤ –ë–î
3. –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–∞ ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Å–ø–∏—Å–∫–µ
4. `routing_score` –±–µ—Å—Å–º—ã—Å–ª–µ–Ω ‚Äî –ø—Ä–æ—Å—Ç–æ 1.0 –∏–ª–∏ 0.5, –Ω–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ
5. ApprovalManager –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–ª–∞–Ω–∞

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã üî¥

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π**
   - `orchestrated_execution()` –ø—Ä–æ—Å—Ç–æ –±–µ—Ä–µ—Ç –ø–µ—Ä–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
   - –î–æ–ª–∂–Ω–∞ –≤—ã–±–∏—Ä–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ capabilities –∏ confidence score
   - –°—Ç–∞—Ç—É—Å: ‚ùå CRITICAL

2. **UserOrchestrator –º–æ–¥–µ–ª—å ‚Äî –º–µ—Ä—Ç–≤—ã–π –∫–æ–¥**
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ –ë–î –∏ –º–æ–¥–µ–ª—è—Ö, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
   - Orchestrator —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ UserAgent —Å —Ä–æ–ª—å—é "orchestrator"
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –£–¥–∞–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –∏ –º–æ–¥–µ–ª—å
   - –°—Ç–∞—Ç—É—Å: üî¥ CRITICAL (–ø—É—Ç–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)

3. **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏**
   - –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –≤—ã–±–æ—Ä –ø–æ capabilities
   - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –ø–µ—Ä–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
   - –°—Ç–∞—Ç—É—Å: üî¥ CRITICAL

4. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ApprovalManager**
   - –ù–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–ª–∞–Ω–∞ (3+ –∑–∞–¥–∞—á –∏–ª–∏ > $0.10)
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –¥–æ—Ä–æ–≥–æ–π/—Å–ª–æ–∂–Ω—ã–π –ø–ª–∞–Ω –∏ –æ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –±–µ–∑ –æ–¥–æ–±—Ä–µ–Ω–∏—è
   - –°—Ç–∞—Ç—É—Å: üü† HIGH

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ

üéØ **–§–∞–∑–∞ 1: Intelligent Agent Routing** (2-3 –¥–Ω—è) ‚Üê **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø**
1. –£–¥–∞–ª–∏—Ç—å `UserOrchestrator` –º–æ–¥–µ–ª—å –∏ —Ç–∞–±–ª–∏—Ü—É (–º–∏–≥—Ä–∞—Ü–∏—è)
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `select_best_agent_for_task()` –º–µ—Ç–æ–¥
   - –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ ‚Üí –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ–º—ã—Ö capabilities
   - –ü–æ–∏—Å–∫ –∞–≥–µ–Ω—Ç–∞ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ–º
   - –í–æ–∑–≤—Ä–∞—Ç (agent_id, confidence_score)
3. –û–±–Ω–æ–≤–∏—Ç—å `orchestrated_execution()` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥
4. –î–æ–±–∞–≤–∏—Ç—å unit –∏ integration tests
5. Deploy –∏ smoke tests

üéØ **–§–∞–∑–∞ 2: Advanced Orchestration** (2-3 –Ω–µ–¥–µ–ª–∏) ‚Üê **–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û**
1. –ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞—Ñ–∞ –∑–∞–¥–∞—á (–Ω–µ LLM)
2. –¢–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
3. –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏ –ø–ª–∞–Ω–∞
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –æ–¥–æ–±—Ä–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

---

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è follow-up

### –§–∞–∑–∞ 1 (2-3 –¥–Ω—è)
- [ ] –°–æ–∑–¥–∞–Ω–∞ OpenSpec change –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
- [ ] –£–¥–∞–ª–µ–Ω–∞ `UserOrchestrator` –º–æ–¥–µ–ª—å –∏ —Ç–∞–±–ª–∏—Ü–∞ (migration)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `select_best_agent_for_task()` –º–µ—Ç–æ–¥
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∞ `orchestrated_execution()` —Ñ—É–Ω–∫—Ü–∏—è
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã unit tests (routing logic)
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã integration tests (with endpoints)
- [ ] –ü—Ä–æ–≤–µ–¥–µ–Ω code review
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] Deploy –Ω–∞ staging
- [ ] Smoke tests –ø—Ä–æ–π–¥–µ–Ω—ã
- [ ] Deploy –Ω–∞ production

### –§–∞–∑–∞ 2 (2-3 –Ω–µ–¥–µ–ª–∏, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ OpenSpec change –¥–ª—è advanced orchestration
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞—Ñ–∞ –∑–∞–¥–∞—á
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- [ ] –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω ApprovalManager –¥–ª—è auto-approval –ø—Ä–æ–≤–µ—Ä–æ–∫
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ deploy

